import HID1 from "../../assets/work/HID/HID Mobile Access one.png";
import HID2 from "../../assets/work/HID/HID Mobile Access two.png";
import HID3 from "../../assets/work/HID/HID Mobile Access three.png";
import HID4 from "../../assets/work/HID/HID Mobile Access four.png";
import HID5 from "../../assets/work/HID/HID Mobile Access five.png";
import AQM1 from "../../assets/work/AQM/AdafruitAndRaspberryPi4.jpg";
import AQM2 from "../../assets/work/AQM/AQMhardware.jpg";
import AQM3 from "../../assets/work/AQM/AQMhardware2.jpg";
import AQM4 from "../../assets/work/AQM/Shell logs 2023-07-21 at 12.12.18 p.m..png";
import AQM5 from "../../assets/work/AQM/While collecting sensor data with window opened.png";
import AQM6 from "../../assets/work/AQM/AirQualityEmailAlert.png";
import AQM7 from "../../assets/work/AQM/temperature_humidity_data_2023-08-05T21_41_29+0100.png";
import AQM8 from "../../assets/work/AQM/24_hours_data_2023-08-05T21_41_29+0100.png";
import AQM9 from "../../assets/work/AQM/co2_data_2023-08-05T21_41_29+0100.png";
import AQM10 from "../../assets/work/AQM/ProjectBoard1.png";
import AQM11 from "../../assets/work/AQM/ProjectBoard2.png";
import AQM12 from "../../assets/work/AQM/AQMMobileApp1.jpg";
import AQM13 from "../../assets/work/AQM/AQMMobileApp2.jpg";
import AQM14 from "../../assets/work/AQM/Intelligent Indoor Air Quality and Ventilation Management in Confined Spaces using IoT - 22262621 - Vishnu Simha Dussa.pdf";
import AndroidFeat1 from "../../assets/work/AndroidFeatures/Project Structure1.png";
import AndroidFeat2 from "../../assets/work/AndroidFeatures/Project Structure2.png";
import AndroidFeat3 from "../../assets/work/AndroidFeatures/XMLBranchesFeatures.png";
import AndroidFeat4 from "../../assets/work/AndroidFeatures/jetpackComposeAppbranches.png";
import AndroidFeat5 from "../../assets/work/AndroidFeatures/xmlscreen1.png";
import AndroidFeat6 from "../../assets/work/AndroidFeatures/Xmlscreen2.png";
import OpenWeatherApp1 from "../../assets/work/WeatherDashboard/WeatherDashboard1.png";
import OpenWeatherApp2 from "../../assets/work/WeatherDashboard/WeatherDashboard2.png";
import SK1 from "../../assets/work/StockKeeper/WelcomeScreen1.png";
import SK2 from "../../assets/work/StockKeeper/WelcomeScreenError.png";
import SK3 from "../../assets/work/StockKeeper/StockScreen.png";
import SK4 from "../../assets/work/StockKeeper/AddNewStock.png";
import SK5 from "../../assets/work/StockKeeper/allstocks.png";
import SK6 from "../../assets/work/StockKeeper/DynamicDarkMaterialTheme.png";
import SK7 from "../../assets/work/StockKeeper/searchStock.png";
import SK8 from "../../assets/work/StockKeeper/stockbyexpirydate.png";
import SK9 from "../../assets/work/StockKeeper/stockbyquantity.png";
import SK10 from "../../assets/work/StockKeeper/PlanScreen.png";
import SK11 from "../../assets/work/StockKeeper/PlanMakerAll.png";
import SK12 from "../../assets/work/StockKeeper/PlanMakerByCategory.png";
import SK13 from "../../assets/work/StockKeeper/PlanMakerByShop.png";
import SK14 from "../../assets/work/StockKeeper/PlanScreen2.png";
import SK15 from "../../assets/work/StockKeeper/ProfileScreen.png";
import SK16 from "../../assets/work/StockKeeper/AlertsScreen.png";
import CN1 from "../../assets/work/Cloudnine/Home.png";
import CN2 from "../../assets/work/Cloudnine/Home2.png";
import CN3 from "../../assets/work/Cloudnine/Gallery.png";
import CN4 from "../../assets/work/Cloudnine/ServicesCorporate.png";
import CN5 from "../../assets/work/Cloudnine/CorporatePlanner.png";
import CN6 from "../../assets/work/Cloudnine/PlanningSpecialDayScreen.png";
import CN7 from "../../assets/work/Cloudnine/Prices.png";
import CN8 from "../../assets/work/Cloudnine/SafteyScreen.png";
import CN9 from "../../assets/work/Cloudnine/Enquiry.png";
import Res1 from "../../assets/work/Restaurant/Home.png";
import Res2 from "../../assets/work/Restaurant/About.png";
import Res3 from "../../assets/work/Restaurant/Gallery.png";
import Res4 from "../../assets/work/Restaurant/SignUp.png";
import Res5 from "../../assets/work/Restaurant/login.png";
import Res6 from "../../assets/work/Restaurant/Menu.png";
import Res7 from "../../assets/work/Restaurant/Specials.png";
import Res8 from "../../assets/work/Restaurant/Team.png";
import Res9 from "../../assets/work/Restaurant/CustomerReview.png";
import Res10 from "../../assets/work/Restaurant/Bottom Nav.png";
import Res11 from "../../assets/work/Restaurant/Cart.png";
import CSA1 from "../../assets/work/ClientServer/Server with 3 Clients Connected.png";
import CSA2 from "../../assets/work/ClientServer/Server with 2 Clients Connected.png";
import CSA3 from "../../assets/work/ClientServer/Client Disconnected with Server.png";
import CSA4 from "../../assets/work/ClientServer/Client Connected with Server.png";
import CSA5 from "../../assets/work/ClientServer/Server with 3 Clients Connected with Client windows.png";
import CSA6 from "../../assets/work/ClientServer/Server with 2 Clients Connected and Client windows.png";
import CSA7 from "../../assets/work/ClientServer/Server with 2 Clients Collision.png";
import CSA8 from "../../assets/work/ClientServer/Server with 3 Clients Connected with prev coordinates.png";
import CSA9 from "../../assets/work/ClientServer/Server with 3 Clients Connected and 2 Colliding.png";
import DAML1 from "../../assets/work/DAML/DAML1.png";
import DAML2 from "../../assets/work/DAML/DAML2.png";
import DAML3 from "../../assets/work/DAML/DAML3.png";
import DAML4 from "../../assets/work/DAML/DAML4.png";
import DAML5 from "../../assets/work/DAML/DAML5.png";
import DAML6 from "../../assets/work/DAML/DAML6.png";
import DAML7 from "../../assets/work/DAML/DAML7.png";
import DAML8 from "../../assets/work/DAML/DAML8.png";
import AndroidPlaceholder from "../../assets/work/Android.png";
import CppPlaceholder from "../../assets/work/cpp.png";
import PythonPlaceholder from "../../assets/work/Python.png";
import JavaPlaceholder from "../../assets/work/java.png";
import JavaSpringBootPlaceholder from "../../assets/work/javaSpringBoot.png";
import JavaSpringBootReactPlaceholder from "../../assets/work/JavaSpringBootReact.png";
import ReactJavaScriptPlaceholder from "../../assets/work/ReactJavaScript.png";
import IoTPlaceholder from "../../assets/work/IoT.png";
import NotesApp1 from "../../assets/work/NotesApp/NoteslandingScreen.png";
import NotesApp2 from "../../assets/work/NotesApp/NotesEmpty.png";
import NotesApp3 from "../../assets/work/NotesApp/NotesEmptyEditScreen.png";
import NotesApp4 from "../../assets/work/NotesApp/NotesEditScreenFilled.png";
import NotesApp5 from "../../assets/work/NotesApp/NotesListScreen.png";
import NotesApp6 from "../../assets/work/NotesApp/PasswordGeneratorScreen.png";
import ChatApp1 from "../../assets/work/fullstackChatApp/ChatSphereSignup.png";
import ChatApp2 from "../../assets/work/fullstackChatApp/ChatSphereLogin.png";
import ChatApp3 from "../../assets/work/fullstackChatApp/ChatSphereUpdatedDashboard.png";
import ChatApp4 from "../../assets/work/fullstackChatApp/ChatSpherePostAndComment.png";
import ChatApp5 from "../../assets/work/fullstackChatApp/ChatSphereDashboard.png";
import ChatApp6 from "../../assets/work/fullstackChatApp/ChatSphereFeedPostCategories.png";
import ChatApp7 from "../../assets/work/fullstackChatApp/ChatSphereQuestion.png";
import ChatApp8 from "../../assets/work/fullstackChatApp/ChatSphereCategories.png";
import ChatApp9 from "../../assets/work/fullstackChatApp/ChatSphereCategories2.png";

import React, { useState, useEffect, useRef } from "react";
import {
  FiCpu,
  FiGithub,
  FiExternalLink,
  FiChevronLeft,
  FiChevronRight,
  FiServer,
  FiGlobe,
  FiDatabase,
  FiActivity,
  FiPlay,
  FiPause,
  FiX,
  FiZoomIn,
  FiMaximize2,
  FiMinimize2,
} from "react-icons/fi";

import { FaMobileAlt, FaCloud, FaCodeBranch } from "react-icons/fa";
import { FaChartBar, FaBrain } from "react-icons/fa";
import { AiOutlineLineChart } from "react-icons/ai";
import { BsBarChartLine } from "react-icons/bs";
import { GoDatabase } from "react-icons/go";
import { GiArtificialIntelligence } from "react-icons/gi";

const Projects = React.forwardRef((props, ref) => {
  const projects = [
    {
      name: "HID Mobile Access",
      description:
        "Contributed to the development and maintenance of HID Mobile Access, including app, SDK, and Android watch features. Worked in an agile team, handled sprint stories and customer issues using JIRA.",
      technologies: [
        "Kotlin",
        "Java",
        "Jetpack Compose",
        "XML",
        "Retrofit",
        "Room",
        "Hilt",
        "Firebase",
        "DataStore",
        "Coroutines",
        "Material Design",
        "Navigation",
      ],
      media: [HID1, HID2, HID3, HID4, HID5],
      category: "Mobile Development",
      links: [
        { type: "demo", url: "https://www.youtube.com/watch?v=Yfy0Y6YIJ7c" },
      ],
    },
    {
      name: "StocKeeper - Android Stock Management App",
      description:
        "The ultimate stock management tool for homes and businesses. Track, plan, and purchase with ease. You can take care of your inventory with this StocKeeper app. Track stock levels, set alerts, and optimize your purchases. Perfect for homes and businesses. ",
      technologies: [
        "Kotlin",
        "Jetpack Compose",
        "Retrofit",
        "Firebase",
        "Room",
        "DataStore",
        "Material Design",
        "Real-time Database",
        "Hilt",
        "Coroutines",
      ],
      media: [
        AndroidPlaceholder,
        SK1,
        SK2,
        SK3,
        SK4,
        SK5,
        SK6,
        SK7,
        SK8,
        SK9,
        SK10,
        SK11,
        SK12,
        SK13,
        SK14,
        SK15,
        SK16,
      ],
      category: "Mobile Development",
      links: [
        { type: "github", url: "https://github.com/Vishnusimha/StocKeeper" },
      ],
    },
    {
      name: "IoT Indoor Air Quality Monitoring System",
      description:
        "Designed and implemented an IoT-based system to monitor CO2, humidity, and temperature using Raspberry Pi and Adafruit SCD40. Real-time data visualization and alerting through a custom Android app.",
      technologies: [
        "Python Flask",
        "Raspberry Pi",
        "Linux",
        "Edge Computing",
        "Cloud Storage",
        "Sensor Data Analysis",
      ],
      media: [
        IoTPlaceholder,
        PythonPlaceholder,
        AQM1,
        AQM2,
        AQM3,
        AQM4,
        AQM5,
        AQM6,
        AQM7,
        AQM8,
        AQM9,
        AQM10,
        AQM11,
        AQM12,
        AQM13,
      ],
      category: "IoT",
      links: [
        {
          type: "github",
          url: "https://github.com/Vishnusimha/IndoorAirQualityEE5003",
        },
        {
          type: "demo",
          url: "https://github.com/Vishnusimha/IndoorAirQualityEE5003/blob/main/README.md",
        },
        {
          type: "pdf",
          url: AQM14,
        },
      ],
    },
    {
      name: "Social Chat Application - Full-Stack (Android + Spring Boot)",
      description:
        "Built a scalable full-stack social chat app using Java (Spring Boot) microservices and React. Designed secure REST APIs for users, posts, and comments, with JWT authentication, resilient service communication, and MySQL data storage. Created a responsive React frontend for seamless user experience, routing all requests via an API gateway.",
      technologies: [
        "Java 17+",
        "Spring Boot",
        "Spring Cloud Gateway",
        "Eureka",
        "Spring Data JPA",
        "Resilience4j",
        "MySQL",
        "JWT",
        "Gradle",
        "Docker",
        "React (19+)",
        "JavaScript (ES6+)",
        "HTML5",
        "CSS3",
        "Android",
        "Kotlin",
        "Jetpack Compose",
        "Coroutines",
        "Retrofit",
        "Room",
      ],
      media: [
        JavaSpringBootReactPlaceholder,
        ChatApp1,
        ChatApp2,
        ChatApp3,
        ChatApp4,
        ChatApp5,
        ChatApp6,
        ChatApp7,
        ChatApp8,
        ChatApp9,
        AndroidPlaceholder,
      ],
      category: "Full-Stack Development",
      links: [
        {
          type: "github",
          url: "https://github.com/Vishnusimha/SecretMessage",
        },
        {
          type: "github",
          url: "https://github.com/Vishnusimha/chat-microservices",
        },
      ],
    },
    {
      name: "Full-Stack Web Application - Online Business",
      description:
        "Developed a web application for an online takeaway restaurant business using Spring Boot and MySQL. The project features a responsive design, user authentication, and a dynamic menu. The backend is powered by Spring Boot, while the frontend is developed using HTML, CSS, and JavaScript.",
      technologies: [
        "Java",
        "Spring Boot",
        "MySQL",
        "Microservices",
        "Spring Security",
        "Spring Data JPA",
        "Spring MVC",
        "Rest API",
        "MVVM",
        "HTML/CSS",
        "JavaScript",
      ],
      media: [
        Res1,
        Res2,
        Res3,
        Res4,
        Res5,
        Res6,
        Res7,
        Res8,
        Res9,
        Res10,
        Res11,
      ],
      category: "Full-Stack Development",
      links: [
        { type: "github", url: "https://github.com/Vishnusimha/ee417-project" },
      ],
    },
    {
      name: "Balloon Decor Business Website",
      description:
        "A complete online business website for a balloon decor venture. This full-stack project utilizes Spring Boot and MySQL for the server-side logic and database, complemented by a basic HTML/CSS frontend",
      technologies: [
        "Java",
        "Spring Boot",
        "MySQL",
        "Microservices",
        "MVVM",
        "HTML/CSS",
        "JavaScript",
        "Rest API",
      ],
      media: [CN1, CN2, CN3, CN4, CN5, CN6, CN7, CN8, CN9],
      category: "Full-Stack Development",
      links: [
        { type: "github", url: "https://github.com/Vishnusimha/cloudnine" },
        { type: "github", url: "https://github.com/Vishnusimha/webapp" },
      ],
    },
    {
      name: "Feature-Rich Android Applications",
      description:
        "Created modern Android apps using Kotlin with Jetpack Compose and XML views, integrating technologies like Retrofit, Room, Firebase, Hilt, and Coroutines to deliver scalable, maintainable codebases.",
      technologies: [
        "Kotlin",
        "Jetpack Compose",
        "XML",
        "Retrofit",
        "Room",
        "Firebase",
        "Hilt",
        "Coroutines",
        "OkHttp",
        "DataStore",
        "Material Design",
        "SonarQube Integration",
      ],
      media: [
        AndroidPlaceholder,
        AndroidFeat1,
        AndroidFeat2,
        AndroidFeat3,
        AndroidFeat4,
        AndroidFeat5,
        AndroidFeat6,
      ],
      category: "Mobile Development",
      links: [
        {
          type: "github",
          url: "https://github.com/Vishnusimha/FeaturesCompose",
        },
        {
          type: "github",
          url: "https://github.com/Vishnusimha/FeaturesXml",
        },
      ],
    },
    {
      name: "Notes - Android App",
      description:
        "Developed a note-taking application for Android using Kotlin and Jetpack Compose. Implemented features like user authentication, note creation, editing, and deletion. Utilized Room Database for local data storage and ensured a smooth user experience with a responsive UI.",
      technologies: ["Kotlin", "Android", "Jetpack Compose", "Room Database"],
      media: [
        AndroidPlaceholder,
        NotesApp1,
        NotesApp2,
        NotesApp3,
        NotesApp4,
        NotesApp5,
        NotesApp6,
      ],
      category: "Mobile Development",
      links: [
        {
          type: "github",
          url: "https://github.com/Vishnusimha/Notes",
        },
      ],
    },
    {
      name: "Personal Portfolio Website",
      description:
        "A modern, responsive portfolio website built with React showcasing professional experience, projects, and technical skills. Features interactive project galleries, markdown-based blog system with syntax highlighting, downloadable resume, contact form integration, and dark/light theme toggle. Implements XSS protection with DOMPurify for secure content rendering.",
      technologies: [
        "React",
        "React Router",
        "React Icons",
        "React Typed",
        "Framer Motion",
        "Lottie React",
        "Marked",
        "Highlight.js",
        "DOMPurify",
        "EmailJS",
        "Formspree",
        "Tailwind CSS",
        "PostCSS",
        "GitHub Pages",
        "Vercel",
      ],
      media: [ReactJavaScriptPlaceholder],
      category: "Full-Stack Development",
      links: [
        {
          type: "github",
          url: "https://github.com/Vishnusimha/vishnuportfolio",
        },
        {
          type: "demo",
          url: "https://vishnusimha.github.io/vishnuportfolio",
        },
        {
          type: "demo",
          url: "https://vishnusimha.github.io/vishnuportfolio/home",
        },
      ],
    },
    {
      name: "Weather Dashboard – React Project",
      description:
        "Developed a responsive weather dashboard using React and OpenWeatherMap API. Features include data fetching, error handling, and real-time UI updates. Deployed via GitHub Pages.",
      technologies: ["React", "JavaScript", "REST API", "CSS"],
      media: [OpenWeatherApp1, OpenWeatherApp2],
      category: "Full-Stack Development",
      links: [
        {
          type: "github",
          url: "https://github.com/Vishnusimha/react-weather-dashboard",
        },
        {
          type: "demo",
          url: "https://vishnusimha.github.io/react-weather-dashboard/",
        },
      ],
    },
    {
      name: "Java Client-Server Architecture for Multi-Agent Robot Simulation",
      description:
        "Implemented a multi-threaded client-server application in Java for simulating and controlling multiple robot clients. The architecture features a Swing-based GUI on both ends, enabling real-time interaction and visualization. Key functionalities include network communication via Robot objects, concurrent handling of multiple clients, dynamic GUI updates (robot positions, collision alerts, connection status), and client-side speed control with optional automatic updates.",
      technologies: [
        "Client-Server Architecture",
        "Real-time Control",
        "Object Serialization",
        "Multi-threading",
        "Event Handling",
        "Java Sockets",
        "Java GUI",
        "Java AWT Canvas",
        "Java Swing",
        "Automatic Updates",
      ],
      category: "Software Systems",
      media: [
        JavaPlaceholder,
        CSA1,
        CSA2,
        CSA3,
        CSA4,
        CSA5,
        CSA6,
        CSA7,
        CSA8,
        CSA9,
      ],
      links: [
        {
          type: "github",
          url: "https://github.com/Vishnusimha/JavaClientServerApplication",
        },
      ],
    },
    {
      name: "Human Activity Recognition - Data Analysis and ML",
      description:
        "Built a predictive model using supervised learning on sensor data from the Extrasensory dataset. Performed feature engineering, performance analysis, and model selection.",
      technologies: ["Python", "Jupyter Notebook", "Pandas", "NumPy", "ML"],
      media: [
        PythonPlaceholder,
        DAML1,
        DAML2,
        DAML3,
        DAML4,
        DAML5,
        DAML6,
        DAML7,
        DAML8,
      ],
      category: "Data Science / Machine Learning",
      links: [
        { type: "github", url: "https://github.com/Vishnusimha/GoogleCollab" },
        {
          type: "pdf",
          url: "https://github.com/Vishnusimha/GoogleCollab/blob/main/DA_ML%20for%20git.pdf",
        },
      ],
    },
    {
      name: "AES-128 and PRESENT-80 Encryption-Algorithms - Academic Project",
      description:
        "Implemented AES-128 and PRESENT-80 cipher encryption in C++, ensuring adherence to specified key and block sizes. Validated implementation through ECB mode test encryptions and provided a concise comparison between the two algorithms.",
      technologies: [
        "C++",
        "Python",
        "Encryption Software",
        "Object-Oriented Programming (OOP)",
        "Software Design",
      ],
      // TODO : Add AES-128 and PRESENT-80 images
      media: [CppPlaceholder, PythonPlaceholder],
      category: "Software Systems",
      links: [
        {
          type: "github",
          url: "https://github.com/Vishnusimha/AES-Encryption-Algorithm",
        },
        {
          type: "pdf",
          url: "https://github.com/Vishnusimha/Present80-Encryption-Algorithm",
        },
      ],
    },
    {
      name: "C++ Design Challenge - Academic Project",
      description:
        "Designed and implemented a robust C++ security system with keypad, fingerprint, and hybrid locks for flexible authentication. Proficiently applied OOP principles like inheritance, polymorphism, and dynamic memory management. Showcased expertise in container classes and algorithms for efficient data manipulation. Overall, demonstrated strong capabilities in software design and implementation.",
      technologies: [
        "C++",
        "Object-Oriented Programming (OOP)",
        "Software Design",
      ],
      // TODO :C++ Design Challenge images
      media: [CppPlaceholder],
      category: "Software Systems",
      links: [
        {
          type: "github",
          url: "https://github.com/Vishnusimha/CppDesignChallange",
        },
        {
          type: "pdf",
          url: "https://github.com/Vishnusimha/CppDesignChallange/blob/main/C%2B%2B%20Design%20challenge%20code%20Documentation%20GIT.pdf",
        },
      ],
    },
  ];

  const [currentMediaIndex, setCurrentMediaIndex] = useState(
    Array(projects.length).fill(0)
  );

  // State to manage the active category filter, null means "All"
  const [activeCategory, setActiveCategory] = useState(null);

  // Auto-carousel states
  const [isAutoPlaying, setIsAutoPlaying] = useState(
    Array(projects.length).fill(true)
  );
  const intervalRefs = useRef(Array(projects.length).fill(null));
  const [userPausedProjects, setUserPausedProjects] = useState(
    Array(projects.length).fill(false)
  );

  // Lightbox/Modal states
  const [lightboxOpen, setLightboxOpen] = useState(false);
  const [lightboxProject, setLightboxProject] = useState(null);
  const [lightboxImageIndex, setLightboxImageIndex] = useState(0);
  const [lightboxZoomed, setLightboxZoomed] = useState(false);
  const [isFullScreen, setIsFullScreen] = useState(false);

  // Get unique categories from the projects data
  const categories = Array.from(
    new Set(projects.map((project) => project.category))
  );

  // Auto-carousel functionality
  const startAutoPlay = (projectIndex) => {
    if (projects[projectIndex].media.length <= 1) return;

    // Clear existing interval if any
    if (intervalRefs.current[projectIndex]) {
      clearInterval(intervalRefs.current[projectIndex]);
    }

    const intervalId = setInterval(() => {
      setCurrentMediaIndex((prevIndexes) =>
        prevIndexes.map((index, i) =>
          i === projectIndex
            ? (index + 1) % projects[projectIndex].media.length
            : index
        )
      );
    }, 3000); // Change slide every 3 seconds

    intervalRefs.current[projectIndex] = intervalId;
    setIsAutoPlaying((prev) =>
      prev.map((playing, i) => (i === projectIndex ? true : playing))
    );
    setUserPausedProjects((prev) =>
      prev.map((paused, i) => (i === projectIndex ? false : paused))
    );
  };

  const stopAutoPlay = (projectIndex) => {
    if (intervalRefs.current[projectIndex]) {
      clearInterval(intervalRefs.current[projectIndex]);
      intervalRefs.current[projectIndex] = null;
    }
    setIsAutoPlaying((prev) =>
      prev.map((playing, i) => (i === projectIndex ? false : playing))
    );
    setUserPausedProjects((prev) =>
      prev.map((paused, i) => (i === projectIndex ? true : paused))
    );
  };

  const toggleAutoPlay = (projectIndex) => {
    if (isAutoPlaying[projectIndex]) {
      stopAutoPlay(projectIndex);
    } else {
      startAutoPlay(projectIndex);
    }
  };

  // Lightbox/Modal functions
  const openLightbox = (projectIndex, imageIndex) => {
    setLightboxProject(projects[projectIndex]);
    setLightboxImageIndex(imageIndex);
    setLightboxOpen(true);
    setLightboxZoomed(false);
  };

  const closeLightbox = () => {
    setLightboxOpen(false);
    setLightboxProject(null);
    setLightboxImageIndex(0);
    setLightboxZoomed(false);
    setIsFullScreen(false);
    // Exit fullscreen if currently in fullscreen mode
    if (document.fullscreenElement) {
      document.exitFullscreen();
    }
  };

  const nextLightboxImage = () => {
    if (
      lightboxProject &&
      lightboxImageIndex < lightboxProject.media.length - 1
    ) {
      setLightboxImageIndex(lightboxImageIndex + 1);
      setLightboxZoomed(false);
    }
  };

  const prevLightboxImage = () => {
    if (lightboxProject && lightboxImageIndex > 0) {
      setLightboxImageIndex(lightboxImageIndex - 1);
      setLightboxZoomed(false);
    }
  };

  const toggleLightboxZoom = () => {
    setLightboxZoomed(!lightboxZoomed);
  };

  const toggleFullScreen = async () => {
    if (!document.fullscreenElement) {
      // Enter fullscreen
      const lightboxContainer = document.querySelector(".lightbox-container");
      if (lightboxContainer && lightboxContainer.requestFullscreen) {
        try {
          await lightboxContainer.requestFullscreen();
          setIsFullScreen(true);
        } catch (err) {
          console.error("Error entering fullscreen:", err);
        }
      }
    } else {
      // Exit fullscreen
      try {
        await document.exitFullscreen();
        setIsFullScreen(false);
      } catch (err) {
        console.error("Error exiting fullscreen:", err);
      }
    }
  };

  // Keyboard navigation for lightbox
  useEffect(() => {
    const handleKeyDown = (e) => {
      if (!lightboxOpen) return;

      switch (e.key) {
        case "Escape":
          closeLightbox();
          break;
        case "ArrowLeft":
          prevLightboxImage();
          break;
        case "ArrowRight":
          nextLightboxImage();
          break;
        case "z":
        case "Z":
          toggleLightboxZoom();
          break;
        case "f":
        case "F":
          toggleFullScreen();
          break;
        default:
          break;
      }
    };

    document.addEventListener("keydown", handleKeyDown);
    return () => document.removeEventListener("keydown", handleKeyDown);
  }, [lightboxOpen, lightboxImageIndex, lightboxProject]);

  // Handle fullscreen change events
  useEffect(() => {
    const handleFullscreenChange = () => {
      setIsFullScreen(!!document.fullscreenElement);
    };

    document.addEventListener("fullscreenchange", handleFullscreenChange);
    return () =>
      document.removeEventListener("fullscreenchange", handleFullscreenChange);
  }, []);

  // Start auto-play for all projects on component mount
  useEffect(() => {
    projects.forEach((project, index) => {
      if (project.media.length > 1) {
        startAutoPlay(index);
      }
    });

    // Cleanup intervals on unmount
    return () => {
      intervalRefs.current.forEach((intervalId) => {
        if (intervalId) {
          clearInterval(intervalId);
        }
      });
    };
  }, []); // Empty dependency array - only run once on mount

  // Handle category changes
  useEffect(() => {
    // Clear all intervals when category changes
    intervalRefs.current.forEach((intervalId) => {
      if (intervalId) {
        clearInterval(intervalId);
      }
    });
    intervalRefs.current = Array(projects.length).fill(null);

    // Restart auto-play for projects that weren't manually paused
    setTimeout(() => {
      projects.forEach((project, index) => {
        if (project.media.length > 1 && !userPausedProjects[index]) {
          startAutoPlay(index);
        }
      });
    }, 100);
  }, [activeCategory]);

  const getCategoryIcons = (category) => {
    switch (category) {
      case "Mobile Development":
        return (
          <>
            <FaMobileAlt className="inline-icon" />
          </>
        );
      case "IoT":
        return (
          <>
            <FiCpu className="inline-icon" />
            <FiActivity className="inline-icon" />
            <FiGlobe className="inline-icon" />
            <FaMobileAlt className="inline-icon" />
          </>
        );
      case "Full-Stack Development":
        return (
          <>
            <FiGlobe className="inline-icon" />
            <FaCodeBranch className="inline-icon" />
            <FaCloud className="inline-icon" />
            <FiDatabase className="inline-icon" />
            <FiServer className="inline-icon" />
          </>
        );
      case "Web Development":
        return (
          <>
            <FiGlobe className="inline-icon" />
            <FaCloud className="inline-icon" />
          </>
        );
      case "Data Science / Machine Learning":
        return (
          <>
            <FaBrain className="inline-icon" />
            <GoDatabase className="inline-icon" />
            <GiArtificialIntelligence className="inline-icon" />
            <FaChartBar className="inline-icon" />
            <AiOutlineLineChart className="inline-icon" />
            <BsBarChartLine className="inline-icon" />
          </>
        );
      case "Software Systems":
        return (
          <>
            <FiCpu className="inline-icon" />
            <FiServer className="inline-icon" />
            <FaCodeBranch className="inline-icon" />
          </>
        );
      default:
        return <FiCpu className="inline-icon" />;
    }
  };

  const handleNextMedia = (projectIndex) => {
    // Stop auto-play when user interacts and mark as manually paused
    stopAutoPlay(projectIndex);

    setCurrentMediaIndex((prevIndexes) =>
      prevIndexes.map((index, i) =>
        i === projectIndex
          ? (index + 1) % projects[projectIndex].media.length
          : index
      )
    );
  };

  const handlePrevMedia = (projectIndex) => {
    // Stop auto-play when user interacts and mark as manually paused
    stopAutoPlay(projectIndex);

    setCurrentMediaIndex((prevIndexes) =>
      prevIndexes.map((index, i) =>
        i === projectIndex
          ? index === 0
            ? projects[projectIndex].media.length - 1
            : index - 1
          : index
      )
    );
  };

  const handleThumbnailClick = (projectIndex, mediaIndex) => {
    // Stop auto-play when user interacts and mark as manually paused
    stopAutoPlay(projectIndex);

    setCurrentMediaIndex((prevIndexes) =>
      prevIndexes.map((index, i) => (i === projectIndex ? mediaIndex : index))
    );
  };

  // Filter projects based on the active category
  const filteredProjects = activeCategory
    ? projects.filter((project) => project.category === activeCategory)
    : projects;

  return (
    <section ref={ref} className="projects-section" id="projects">
      <div className="projects-header">
        <h2 className="projects-title">Projects</h2>
        <div className="projects-divider"></div>
      </div>

      {/* Category Filter Buttons */}
      <div className="category-filters">
        <button
          className={`filter-button ${activeCategory === null ? "active" : ""}`}
          onClick={() => setActiveCategory(null)} // Set active category to null for "All"
        >
          All
        </button>
        {categories.map((category) => (
          <button
            key={category}
            className={`filter-button ${
              activeCategory === category ? "active" : ""
            }`}
            onClick={() => setActiveCategory(category)} // Set active category
          >
            {category}
          </button>
        ))}
      </div>

      <div className="projects-container">
        {filteredProjects.map(
          (
            project,
            index // Use filteredProjects here
          ) => (
            <div key={project.name} className="project-card">
              {" "}
              {/* Using project.name as key for uniqueness */}
              <div className="project-card-inner">
                <div className="project-media-container">
                  <div className="project-media-wrapper">
                    {/* Ensure index is correct for currentMediaIndex */}
                    <img
                      src={
                        project.media[
                          currentMediaIndex[projects.indexOf(project)]
                        ]
                      } // Find the original index of the filtered project
                      alt={`${project.name} screenshot ${
                        currentMediaIndex[projects.indexOf(project)] + 1
                      }`}
                      className="project-media"
                      loading="lazy"
                      onClick={() =>
                        openLightbox(
                          projects.indexOf(project),
                          currentMediaIndex[projects.indexOf(project)]
                        )
                      }
                      style={{ cursor: "pointer" }}
                    />
                  </div>

                  <div className="media-controls">
                    {/* Auto-play toggle button */}
                    <button
                      onClick={() => toggleAutoPlay(projects.indexOf(project))}
                      className="media-control-button auto-play-toggle"
                      aria-label={
                        isAutoPlaying[projects.indexOf(project)]
                          ? "Pause slideshow"
                          : "Play slideshow"
                      }
                      title={
                        isAutoPlaying[projects.indexOf(project)]
                          ? "Pause slideshow"
                          : "Play slideshow"
                      }
                    >
                      {isAutoPlaying[projects.indexOf(project)] ? (
                        <FiPause />
                      ) : (
                        <FiPlay />
                      )}
                    </button>

                    {/* Ensure index is correct for handlers */}
                    <button
                      onClick={() => handlePrevMedia(projects.indexOf(project))}
                      className="media-control-button"
                      aria-label="Previous image"
                    >
                      <FiChevronLeft />
                    </button>
                    <button
                      onClick={() => handleNextMedia(projects.indexOf(project))}
                      className="media-control-button"
                      aria-label="Next image"
                    >
                      <FiChevronRight />
                    </button>
                  </div>

                  {project.media.length > 1 && (
                    <div className="media-thumbnails">
                      {project.media.slice(0, 3).map((media, mediaIndex) => (
                        <button
                          key={mediaIndex}
                          onClick={() =>
                            handleThumbnailClick(
                              projects.indexOf(project),
                              mediaIndex
                            )
                          }
                          className={`thumbnail ${
                            currentMediaIndex[projects.indexOf(project)] ===
                            mediaIndex
                              ? "active"
                              : ""
                          }`}
                          aria-label={`View image ${mediaIndex + 1}`}
                        >
                          <img src={media} alt="" role="presentation" />
                        </button>
                      ))}
                      {project.media.length > 3 && (
                        <span className="thumbnail-count">
                          +{project.media.length - 3}
                        </span>
                      )}
                    </div>
                  )}
                </div>

                <div className="project-content">
                  <div className="project-header">
                    <span className="project-category">
                      {getCategoryIcons(project.category)} {project.category}
                    </span>
                    <h3 className="project-title">{project.name}</h3>
                  </div>

                  <p className="project-description">{project.description}</p>

                  <div className="project-technologies">
                    {project.technologies.map((tech, techIndex) => (
                      <span key={techIndex} className="tech-tag">
                        {tech}
                      </span>
                    ))}
                  </div>
                  <div className="project-links">
                    {project.links?.map((link, linkIndex) => (
                      <a
                        key={linkIndex}
                        href={link.url}
                        target="_blank"
                        rel="noopener noreferrer"
                        className={`project-link ${link.type}`}
                      >
                        {link.type === "github" ? (
                          <>
                            <FiGithub /> View Code
                          </>
                        ) : link.type === "demo" ? (
                          <>
                            <FiExternalLink /> Live Demo
                          </>
                        ) : link.type === "pdf" ? (
                          <>
                            <FiExternalLink /> View Document
                          </>
                        ) : null}
                      </a>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          )
        )}
      </div>

      {/* Lightbox/Modal */}
      {lightboxOpen && lightboxProject && (
        <div className="lightbox-overlay" onClick={closeLightbox}>
          <div
            className="lightbox-container"
            onClick={(e) => e.stopPropagation()}
          >
            <div className="lightbox-header">
              <h3 className="lightbox-title">{lightboxProject.name}</h3>
              <div className="lightbox-controls">
                <button
                  className="lightbox-control-btn"
                  onClick={toggleLightboxZoom}
                  title={lightboxZoomed ? "Zoom out" : "Zoom in"}
                >
                  {lightboxZoomed ? <FiMaximize2 /> : <FiZoomIn />}
                </button>
                <button
                  className="lightbox-control-btn"
                  onClick={toggleFullScreen}
                  title={isFullScreen ? "Exit fullscreen" : "Enter fullscreen"}
                >
                  {isFullScreen ? <FiMinimize2 /> : <FiMaximize2 />}
                </button>
                <button
                  className="lightbox-control-btn"
                  onClick={closeLightbox}
                  title="Close"
                >
                  <FiX />
                </button>
              </div>
            </div>

            <div className="lightbox-content">
              <div className="lightbox-image-container">
                {lightboxImageIndex > 0 && (
                  <button
                    className="lightbox-nav-btn lightbox-nav-prev"
                    onClick={prevLightboxImage}
                    title="Previous image"
                  >
                    <FiChevronLeft />
                  </button>
                )}

                <img
                  src={lightboxProject.media[lightboxImageIndex]}
                  alt={`${lightboxProject.name} screenshot ${
                    lightboxImageIndex + 1
                  }`}
                  className={`lightbox-image ${lightboxZoomed ? "zoomed" : ""}`}
                />

                {lightboxImageIndex < lightboxProject.media.length - 1 && (
                  <button
                    className="lightbox-nav-btn lightbox-nav-next"
                    onClick={nextLightboxImage}
                    title="Next image"
                  >
                    <FiChevronRight />
                  </button>
                )}
              </div>

              <div className="lightbox-info">
                <div className="lightbox-image-counter">
                  {lightboxImageIndex + 1} / {lightboxProject.media.length}
                </div>
                <div className="lightbox-instructions">
                  Use arrow keys to navigate • Press ESC to close • Press Z to
                  zoom • Press F for fullscreen
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </section>
  );
});

export default Projects;
